<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Pattern Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #e0e0e0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: #252525;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #404040;
        }

        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
        }

        .toolbar {
            background: #252525;
            padding: 15px 20px;
            border-bottom: 1px solid #404040;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: auto;
        }

        #canvas {
            background: white;
            border: 1px solid #404040;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        h2 {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            color: #ffffff;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            color: #b0b0b0;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        input[type="number"] {
            width: 100%;
            padding: 6px;
            background: #1a1a1a;
            border: 1px solid #404040;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        select {
            width: 100%;
            padding: 6px;
            background: #1a1a1a;
            border: 1px solid #404040;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        button {
            padding: 8px 16px;
            background: #404040;
            border: 1px solid #606060;
            color: #e0e0e0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            transition: all 0.2s;
        }

        button:hover {
            background: #505050;
            border-color: #707070;
        }

        button:active {
            background: #303030;
        }

        .value-display {
            font-size: 11px;
            color: #808080;
            text-align: right;
        }

        .saved-patterns {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #404040;
        }

        .pattern-item {
            padding: 8px;
            background: #1a1a1a;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid #404040;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pattern-item:hover {
            background: #2a2a2a;
            border-color: #505050;
        }

        .pattern-item button {
            padding: 4px 8px;
            font-size: 10px;
        }

        .status {
            font-size: 11px;
            color: #808080;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Pattern Controls</h2>
        
        <div class="control-group">
            <label>Pattern Type</label>
            <select id="patternType">
                <option value="grid">Grid</option>
                <option value="radial">Radial</option>
                <option value="spiral">Spiral</option>
                <option value="wave">Wave</option>
                <option value="truchet">Truchet Tiles</option>
                <option value="noise">Noise Lines</option>
            </select>
        </div>

        <div class="control-group">
            <label>Density</label>
            <input type="range" id="density" min="5" max="100" value="20">
            <div class="value-display" id="densityValue">20</div>
        </div>

        <div class="control-group">
            <label>Scale</label>
            <input type="range" id="scale" min="1" max="50" value="10">
            <div class="value-display" id="scaleValue">10</div>
        </div>

        <div class="control-group">
            <label>Rotation</label>
            <input type="range" id="rotation" min="0" max="360" value="0">
            <div class="value-display" id="rotationValue">0°</div>
        </div>

        <div class="control-group">
            <label>Stroke Width</label>
            <input type="range" id="strokeWidth" min="0.5" max="10" step="0.5" value="1">
            <div class="value-display" id="strokeWidthValue">1</div>
        </div>

        <div class="control-group">
            <label>Randomness</label>
            <input type="range" id="randomness" min="0" max="100" value="0">
            <div class="value-display" id="randomnessValue">0</div>
        </div>

        <div class="control-group">
            <label>Seed</label>
            <input type="number" id="seed" value="12345">
        </div>

        <button onclick="randomize()" style="width: 100%; margin-bottom: 10px;">Randomize</button>
        <button onclick="generate()" style="width: 100%;">Regenerate</button>

        <div class="saved-patterns">
            <h2>Saved Patterns</h2>
            <div id="savedPatternsList"></div>
        </div>
    </div>

    <div class="canvas-area">
        <div class="toolbar">
            <button onclick="saveToFile()">Export SVG</button>
            <button onclick="loadFromFile()">Import SVG</button>
            <button onclick="saveToStorage()">Save to Browser</button>
            <button onclick="clearStorage()">Clear All Saved</button>
            <span class="status" id="status"></span>
            <input type="file" id="fileInput" accept=".svg" style="display: none;">
        </div>
        
        <div class="canvas-container">
            <svg id="canvas" width="800" height="800" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
    </div>

    <script>
        // Seeded random number generator
        class Random {
            constructor(seed) {
                this.seed = seed;
            }
            
            next() {
                this.seed = (this.seed * 9301 + 49297) % 233280;
                return this.seed / 233280;
            }
        }

        let currentPattern = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadSavedPatterns();
            generate();
            
            // Auto-save to localStorage on parameter change
            ['patternType', 'density', 'scale', 'rotation', 'strokeWidth', 'randomness', 'seed'].forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('change', generate);
                if (element.type === 'range') {
                    element.addEventListener('input', updateValueDisplay);
                }
            });

            document.getElementById('fileInput').addEventListener('change', handleFileLoad);
        });

        function updateValueDisplay(e) {
            const id = e.target.id;
            const value = e.target.value;
            const display = document.getElementById(id + 'Value');
            if (display) {
                display.textContent = id === 'rotation' ? value + '°' : value;
            }
        }

        function getParams() {
            return {
                type: document.getElementById('patternType').value,
                density: parseInt(document.getElementById('density').value),
                scale: parseInt(document.getElementById('scale').value),
                rotation: parseInt(document.getElementById('rotation').value),
                strokeWidth: parseFloat(document.getElementById('strokeWidth').value),
                randomness: parseInt(document.getElementById('randomness').value),
                seed: parseInt(document.getElementById('seed').value)
            };
        }

        function generate() {
            const params = getParams();
            const canvas = document.getElementById('canvas');
            const width = 800;
            const height = 800;
            
            // Clear canvas
            canvas.innerHTML = '';
            
            const rng = new Random(params.seed);
            
            switch(params.type) {
                case 'grid':
                    generateGrid(canvas, width, height, params, rng);
                    break;
                case 'radial':
                    generateRadial(canvas, width, height, params, rng);
                    break;
                case 'spiral':
                    generateSpiral(canvas, width, height, params, rng);
                    break;
                case 'wave':
                    generateWave(canvas, width, height, params, rng);
                    break;
                case 'truchet':
                    generateTruchet(canvas, width, height, params, rng);
                    break;
                case 'noise':
                    generateNoise(canvas, width, height, params, rng);
                    break;
            }
            
            // Update value displays
            ['density', 'scale', 'rotation', 'strokeWidth', 'randomness'].forEach(id => {
                const element = document.getElementById(id);
                const display = document.getElementById(id + 'Value');
                if (display) {
                    display.textContent = id === 'rotation' ? element.value + '°' : element.value;
                }
            });
            
            currentPattern = params;
            showStatus('Pattern generated');
        }

        function generateGrid(canvas, width, height, params, rng) {
            const spacing = width / params.density;
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            for (let i = 0; i <= params.density; i++) {
                for (let j = 0; j <= params.density; j++) {
                    let x = i * spacing;
                    let y = j * spacing;
                    
                    if (params.randomness > 0) {
                        x += (rng.next() - 0.5) * spacing * (params.randomness / 100);
                        y += (rng.next() - 0.5) * spacing * (params.randomness / 100);
                    }
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', y);
                    circle.setAttribute('r', params.scale / 2);
                    circle.setAttribute('fill', 'none');
                    circle.setAttribute('stroke', 'black');
                    circle.setAttribute('stroke-width', params.strokeWidth);
                    g.appendChild(circle);
                }
            }
            
            if (params.rotation !== 0) {
                g.setAttribute('transform', `rotate(${params.rotation} ${width/2} ${height/2})`);
            }
            
            canvas.appendChild(g);
        }

        function generateRadial(canvas, width, height, params, rng) {
            const cx = width / 2;
            const cy = height / 2;
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            for (let i = 0; i < params.density; i++) {
                const radius = (i / params.density) * (width / 2);
                const points = Math.max(8, Math.floor(params.density * 0.8));
                
                for (let j = 0; j < points; j++) {
                    const angle = (j / points) * Math.PI * 2;
                    let r = radius;
                    
                    if (params.randomness > 0) {
                        r += (rng.next() - 0.5) * 20 * (params.randomness / 100);
                    }
                    
                    const x = cx + Math.cos(angle) * r;
                    const y = cy + Math.sin(angle) * r;
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', y);
                    circle.setAttribute('r', params.scale / 2);
                    circle.setAttribute('fill', 'none');
                    circle.setAttribute('stroke', 'black');
                    circle.setAttribute('stroke-width', params.strokeWidth);
                    g.appendChild(circle);
                }
            }
            
            if (params.rotation !== 0) {
                g.setAttribute('transform', `rotate(${params.rotation} ${width/2} ${height/2})`);
            }
            
            canvas.appendChild(g);
        }

        function generateSpiral(canvas, width, height, params, rng) {
            const cx = width / 2;
            const cy = height / 2;
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            const points = params.density * 10;
            const maxRadius = width / 2;
            
            for (let i = 0; i < points; i++) {
                const t = i / points;
                const angle = t * Math.PI * 2 * (params.density / 5);
                let radius = t * maxRadius;
                
                if (params.randomness > 0) {
                    radius += (rng.next() - 0.5) * 20 * (params.randomness / 100);
                }
                
                const x = cx + Math.cos(angle) * radius;
                const y = cy + Math.sin(angle) * radius;
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', params.scale / 2);
                circle.setAttribute('fill', 'none');
                circle.setAttribute('stroke', 'black');
                circle.setAttribute('stroke-width', params.strokeWidth);
                g.appendChild(circle);
            }
            
            if (params.rotation !== 0) {
                g.setAttribute('transform', `rotate(${params.rotation} ${width/2} ${height/2})`);
            }
            
            canvas.appendChild(g);
        }

        function generateWave(canvas, width, height, params, rng) {
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const rows = params.density;
            const cols = params.density * 2;
            
            for (let i = 0; i < rows; i++) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                let d = '';
                
                for (let j = 0; j <= cols; j++) {
                    const x = (j / cols) * width;
                    let y = (i / rows) * height + Math.sin(j / cols * Math.PI * 2 * (params.density / 10)) * params.scale * 3;
                    
                    if (params.randomness > 0) {
                        y += (rng.next() - 0.5) * 10 * (params.randomness / 100);
                    }
                    
                    if (j === 0) {
                        d += `M ${x} ${y}`;
                    } else {
                        d += ` L ${x} ${y}`;
                    }
                }
                
                path.setAttribute('d', d);
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', 'black');
                path.setAttribute('stroke-width', params.strokeWidth);
                g.appendChild(path);
            }
            
            if (params.rotation !== 0) {
                g.setAttribute('transform', `rotate(${params.rotation} ${width/2} ${height/2})`);
            }
            
            canvas.appendChild(g);
        }

        function generateTruchet(canvas, width, height, params, rng) {
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const tileSize = width / params.density;
            
            for (let i = 0; i < params.density; i++) {
                for (let j = 0; j < params.density; j++) {
                    const x = i * tileSize;
                    const y = j * tileSize;
                    const type = rng.next() > 0.5 ? 0 : 1;
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    
                    if (type === 0) {
                        path.setAttribute('d', `M ${x} ${y} Q ${x + tileSize} ${y} ${x + tileSize} ${y + tileSize}`);
                    } else {
                        path.setAttribute('d', `M ${x + tileSize} ${y} Q ${x} ${y} ${x} ${y + tileSize}`);
                    }
                    
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke', 'black');
                    path.setAttribute('stroke-width', params.strokeWidth);
                    g.appendChild(path);
                }
            }
            
            if (params.rotation !== 0) {
                g.setAttribute('transform', `rotate(${params.rotation} ${width/2} ${height/2})`);
            }
            
            canvas.appendChild(g);
        }

        function generateNoise(canvas, width, height, params, rng) {
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const lines = params.density * 2;
            
            for (let i = 0; i < lines; i++) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                let d = '';
                const points = 50;
                
                for (let j = 0; j <= points; j++) {
                    const x = (j / points) * width;
                    const baseY = (i / lines) * height;
                    const noiseY = (rng.next() - 0.5) * params.scale * 5 * (params.randomness / 100 + 0.1);
                    const y = baseY + noiseY;
                    
                    if (j === 0) {
                        d += `M ${x} ${y}`;
                    } else {
                        d += ` L ${x} ${y}`;
                    }
                }
                
                path.setAttribute('d', d);
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', 'black');
                path.setAttribute('stroke-width', params.strokeWidth);
                g.appendChild(path);
            }
            
            if (params.rotation !== 0) {
                g.setAttribute('transform', `rotate(${params.rotation} ${width/2} ${height/2})`);
            }
            
            canvas.appendChild(g);
        }

        function randomize() {
            document.getElementById('seed').value = Math.floor(Math.random() * 1000000);
            document.getElementById('density').value = Math.floor(Math.random() * 60) + 10;
            document.getElementById('scale').value = Math.floor(Math.random() * 40) + 5;
            document.getElementById('rotation').value = Math.floor(Math.random() * 360);
            document.getElementById('strokeWidth').value = (Math.random() * 5 + 0.5).toFixed(1);
            document.getElementById('randomness').value = Math.floor(Math.random() * 100);
            generate();
        }

        function saveToFile() {
            const canvas = document.getElementById('canvas');
            const svgData = new XMLSerializer().serializeToString(canvas);
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pattern-${Date.now()}.svg`;
            a.click();
            URL.revokeObjectURL(url);
            showStatus('SVG exported');
        }

        function loadFromFile() {
            document.getElementById('fileInput').click();
        }

        function handleFileLoad(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(event.target.result, 'image/svg+xml');
                const svgElement = svgDoc.documentElement;
                
                const canvas = document.getElementById('canvas');
                canvas.innerHTML = svgElement.innerHTML;
                
                showStatus('SVG loaded from file');
            };
            reader.readAsText(file);
        }

        function saveToStorage() {
            const params = getParams();
            const timestamp = Date.now();
            const key = `pattern-${timestamp}`;
            
            const data = {
                params: params,
                timestamp: timestamp,
                svg: new XMLSerializer().serializeToString(document.getElementById('canvas'))
            };
            
            localStorage.setItem(key, JSON.stringify(data));
            loadSavedPatterns();
            showStatus('Pattern saved to browser');
        }

        function loadSavedPatterns() {
            const container = document.getElementById('savedPatternsList');
            container.innerHTML = '';
            
            const keys = Object.keys(localStorage).filter(k => k.startsWith('pattern-')).sort().reverse();
            
            if (keys.length === 0) {
                container.innerHTML = '<div style="font-size: 11px; color: #606060;">No saved patterns</div>';
                return;
            }
            
            keys.forEach(key => {
                const data = JSON.parse(localStorage.getItem(key));
                const date = new Date(data.timestamp);
                
                const item = document.createElement('div');
                item.className = 'pattern-item';
                item.innerHTML = `
                    <span>${data.params.type} - ${date.toLocaleDateString()} ${date.toLocaleTimeString()}</span>
                    <button onclick="deletePattern('${key}')">Delete</button>
                `;
                item.onclick = (e) => {
                    if (e.target.tagName !== 'BUTTON') {
                        loadPattern(key);
                    }
                };
                container.appendChild(item);
            });
        }

        function loadPattern(key) {
            const data = JSON.parse(localStorage.getItem(key));
            const params = data.params;
            
            document.getElementById('patternType').value = params.type;
            document.getElementById('density').value = params.density;
            document.getElementById('scale').value = params.scale;
            document.getElementById('rotation').value = params.rotation;
            document.getElementById('strokeWidth').value = params.strokeWidth;
            document.getElementById('randomness').value = params.randomness;
            document.getElementById('seed').value = params.seed;
            
            generate();
            showStatus('Pattern loaded');
        }

        function deletePattern(key) {
            if (confirm('Delete this pattern?')) {
                localStorage.removeItem(key);
                loadSavedPatterns();
                showStatus('Pattern deleted');
            }
        }

        function clearStorage() {
            if (confirm('Clear all saved patterns?')) {
                const keys = Object.keys(localStorage).filter(k => k.startsWith('pattern-'));
                keys.forEach(k => localStorage.removeItem(k));
                loadSavedPatterns();
                showStatus('All patterns cleared');
            }
        }

        function showStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            setTimeout(() => {
                status.textContent = '';
            }, 2000);
        }
    </script>
</body>
</html>